name: deploy
on: [push]

jobs:
    build:
        name: Hexo Generation
        runs-on: ubuntu-latest

        strategy:
            matrix:
                node-version: [12.x]
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
            - name: Install Latest Pandoc
              run: |
                wget https://github.com/jgm/pandoc/releases/download/2.7/pandoc-2.7-1-amd64.deb
                sudo dpkg -i ./pandoc-2.7-1-amd64.deb
            - run: yarn --frozen-lockfile
            - name: Hexo Generation
              run: yarn build
              id: hexog
            - name: List static files
              run: ls -R public
            - name: Copy SSH keys
              run: |
                mkdir ~/.ssh
                echo "${{ secrets.SCP_KEY }}" > ~/.ssh/id_rsa
                chmod 600 ~/.ssh/id_rsa
            - name: Clean remote public
              run: ssh -o StrictHostKeyChecking=no root@laizn.com "rm -rf /www/public"
            - run: scp -o StrictHostKeyChecking=no -r ./public/ root@laizn.com:/www/
            - name: Clean SSH keys
              run: rm -rf ~/.ssh